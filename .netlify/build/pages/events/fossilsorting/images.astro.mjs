import { c as createComponent, a as renderTemplate, r as renderComponent, m as maybeRenderHead, d as addAttribute } from '../../../chunks/astro/server_DfjRAjzK.mjs';
import 'kleur/colors';
import { $ as $$Layout } from '../../../chunks/Layout_CIWrSEVh.mjs';
import { $ as $$HeadingWithBackground } from '../../../chunks/HeadingWithBackground_CCNCKZ-l.mjs';
import { g as getCollection } from '../../../chunks/_astro_content_BoddU3be.mjs';
import { e as extractReferenceId } from '../../../chunks/functions_UiSr9xwT.mjs';
/* empty css                                        */
export { renderers } from '../../../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Images = createComponent(async ($$result, $$props, $$slots) => {
  const INITIAL_LIMIT = 20;
  const fossilSortingSpecimens = await getCollection("fossilSortingSpecimens");
  const fossilSortingImages = await getCollection("fossilSortingImages");
  const imageMap = new Map(
    fossilSortingImages.map((entry) => [entry.data.id, entry.data])
  );
  function extractImageIds(imageRefs) {
    return imageRefs.map((ref) => extractReferenceId(ref)).filter((id) => id !== null);
  }
  function resolveImages(imageRefs) {
    const imageIds = extractImageIds(imageRefs);
    return imageIds.map((id) => imageMap.get(id)).filter((img) => img !== void 0);
  }
  const sortedSpecimens = fossilSortingSpecimens.map((entry) => {
    const specimen = entry.data;
    const resolvedImages = resolveImages(specimen.images);
    const firstImage = resolvedImages[0];
    return {
      id: specimen.id,
      date: specimen.date,
      description: specimen.description,
      finderCredit: specimen.finderCredit,
      photoCredit: specimen.photoCredit,
      tags: specimen.tags,
      thumbnailSrc: firstImage?.thumbnailSrc ?? "",
      src: firstImage?.src ?? "",
      images: resolvedImages
    };
  }).sort((a, b) => {
    const dateDiff = new Date(b.date).getTime() - new Date(a.date).getTime();
    if (dateDiff !== 0) {
      return dateDiff;
    }
    return a.id.localeCompare(b.id);
  });
  function formatDateString(dateStr) {
    const [year, month, day] = dateStr.split("-");
    const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
    return date.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" });
  }
  const initialSpecimens = sortedSpecimens.slice(0, INITIAL_LIMIT);
  const remainingSpecimens = sortedSpecimens.length - initialSpecimens.length;
  const initialLastId = initialSpecimens.length ? initialSpecimens[initialSpecimens.length - 1].id : null;
  return renderTemplate(_a || (_a = __template(["", ' <script type="module">\n	const gallery = document.querySelector("#image-gallery");\n	const loadMoreButton = document.querySelector("#load-more-images");\n	const searchContainer = document.querySelector("#image-search");\n	const searchInput = document.querySelector("#search-input");\n	const searchButton = document.querySelector("#search-button");\n	const searchReset = document.querySelector("#search-reset");\n	const searchStatus = document.querySelector("#search-status");\n	const searchEmpty = document.querySelector("#search-empty");\n	const searchError = document.querySelector("#search-error");\n	const searchErrorDetails = document.querySelector("#search-error-details");\n	const modal = document.querySelector("#image-modal");\n	const modalPicture = document.querySelector("#image-modal-picture");\n	const modalDescription = document.querySelector("#image-modal-description");\n	const modalFinder = document.querySelector("#image-modal-finder");\n	const modalPhoto = document.querySelector("#image-modal-photo");\n	const modalDate = document.querySelector("#image-modal-date");\n	const modalTags = document.querySelector("#image-modal-tags");\n	const modalPrev = document.querySelector("#image-modal-prev");\n	const modalNext = document.querySelector("#image-modal-next");\n	const modalCounter = document.querySelector("#image-modal-counter");\n	\n	let currentImages = [];\n	let currentImageIndex = 0;\n\n	const formatDateString = (dateStr) => {\n		// Parse date string (YYYY-MM-DD) without timezone issues\n		const [year, month, day] = dateStr.split(\'-\');\n		const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n		return date.toLocaleDateString(\'en-US\', {\n			year: \'numeric\',\n			month: \'long\',\n			day: \'numeric\'\n		});\n	};\n\n	const formatTags = (tags) => {\n		if (!Array.isArray(tags) || tags.length === 0) {\n			return `<p>No tags</p>`;\n		}\n\n		return tags\n			.map(\n				(tag) => `<span class="tag">${tag}</span>`,\n			)\n			.join("");\n	};\n\n	const escapeHtml = (text) => {\n		const div = document.createElement("div");\n		div.textContent = text;\n		return div.innerHTML;\n	};\n\n	const createCard = (specimen) => {\n		const card = document.createElement("article");\n		card.className = "gallery-card fade-in";\n		card.dataset.specimenId = specimen.id;\n\n		const formattedDate = formatDateString(specimen.date);\n		const safeDescription = escapeHtml(specimen.description ?? "");\n\n		card.innerHTML = `\n			<button\n				type="button"\n				class="gallery-card__button"\n				data-specimen-id="${specimen.id}"\n				data-description="${safeDescription}"\n				data-finder="${escapeHtml(specimen.finderCredit ?? "")}"\n				data-photo="${escapeHtml(specimen.photoCredit ?? "")}"\n				data-date="${specimen.date}"\n				data-tags=\'${JSON.stringify(specimen.tags ?? [])}\'\n				data-images=\'${JSON.stringify(specimen.images ?? [])}\'\n			>\n				<img\n					class="gallery-card__image"\n					src="${specimen.thumbnailSrc}"\n					loading="lazy"\n					alt="${safeDescription}"\n				/>\n				<div class="gallery-card__details">\n					<p class="gallery-card__description">${safeDescription}</p>\n					<p class="gallery-card__date"><strong>Date:</strong> ${formattedDate}</p>\n				</div>\n			</button>\n		`;\n\n		return card;\n	};\n\n	const updateLoadMoreVisibility = (hasMore) => {\n		if (!loadMoreButton) {\n			return;\n		}\n\n		loadMoreButton.hidden = !hasMore;\n		if (!hasMore) {\n			loadMoreButton.dataset.lastId = "";\n		}\n	};\n\n	const clearGallery = () => {\n		if (!gallery) return;\n		gallery.innerHTML = "";\n	};\n\n	const renderImages = (specimens) => {\n		if (!gallery || !Array.isArray(specimens)) return;\n		specimens.forEach((specimen, index) => {\n			setTimeout(() => {\n				const card = createCard(specimen);\n				gallery.append(card);\n				// Ensure the browser applies the initial styles before toggling visibility\n				// so the transition runs reliably across browsers.\n				// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n				card.offsetWidth;\n				requestAnimationFrame(() => {\n					card.classList.add("is-visible");\n				});\n			}, index * 100);\n		});\n	};\n\n	const setSearching = (isSearching) => {\n		if (!searchStatus) return;\n		searchStatus.hidden = !isSearching;\n	};\n\n	const clearSearchIndicators = () => {\n		if (searchEmpty) searchEmpty.hidden = true;\n		if (searchError) searchError.hidden = true;\n		if (searchErrorDetails) searchErrorDetails.textContent = "";\n	};\n\n	const showEmpty = () => {\n		if (searchEmpty) searchEmpty.hidden = false;\n	};\n\n	const showError = (error) => {\n		if (!searchError) return;\n		searchError.hidden = false;\n		if (searchErrorDetails) {\n			searchErrorDetails.textContent = String(error?.message ?? error ?? "Unknown error");\n		}\n	};\n\n	const performSearch = async (query) => {\n		try {\n			setSearching(true);\n			clearSearchIndicators();\n			if (loadMoreButton) {\n				loadMoreButton.hidden = true;\n			}\n			const url = new URL("/api/fossil-sorting-images", window.location.origin);\n			if (query) {\n				url.searchParams.set("q", query);\n			}\n			const response = await fetch(url.toString());\n			if (!response.ok) {\n				throw new Error(`Search failed (${response.status})`);\n			}\n			const payload = await response.json();\n			clearGallery();\n			const specimens = Array.isArray(payload.images) ? payload.images : [];\n			if (specimens.length === 0) {\n				showEmpty();\n			} else {\n				renderImages(specimens);\n			}\n		} catch (error) {\n			console.error(error);\n			clearGallery();\n			showError(error);\n		} finally {\n			setSearching(false);\n		}\n	};\n\n	const performReset = async () => {\n		try {\n			setSearching(true);\n			clearSearchIndicators();\n			const url = new URL("/api/fossil-sorting-images", window.location.origin);\n			const response = await fetch(url.toString());\n			if (!response.ok) {\n				throw new Error(`Reset failed (${response.status})`);\n			}\n			const payload = await response.json();\n			clearGallery();\n			const specimens = Array.isArray(payload.images) ? payload.images : [];\n			if (specimens.length === 0) {\n				showEmpty();\n			} else {\n				renderImages(specimens);\n			}\n			if (payload.nextCursor && loadMoreButton) {\n				loadMoreButton.dataset.lastId = payload.nextCursor;\n			}\n			updateLoadMoreVisibility(Boolean(payload.hasMore));\n		} catch (error) {\n			console.error(error);\n			clearGallery();\n			showError(error);\n		} finally {\n			setSearching(false);\n		}\n	};\n\n	searchButton?.addEventListener("click", () => {\n		const q = (searchInput?.value ?? "").trim();\n		void performSearch(q);\n	});\n\n	searchInput?.addEventListener("keydown", (event) => {\n		if (event.key === "Enter") {\n			const q = (searchInput?.value ?? "").trim();\n			void performSearch(q);\n		}\n	});\n\n	searchReset?.addEventListener("click", () => {\n		if (searchInput) {\n			searchInput.value = "";\n		}\n		void performReset();\n	});\n\n	const updateModalImage = (imageIndex) => {\n		if (!currentImages || currentImages.length === 0) return;\n		\n		const image = currentImages[imageIndex];\n		if (!image) return;\n		\n		modalPicture.src = image.src ?? "";\n		modalPicture.alt = image.description ?? "";\n		modalPhoto.textContent = image.photoCredit ?? "";\n		\n		// Update counter\n		if (modalCounter) {\n			modalCounter.textContent = `${imageIndex + 1} / ${currentImages.length}`;\n		}\n		\n		// Update navigation buttons\n		if (modalPrev) {\n			modalPrev.disabled = currentImages.length <= 1;\n			modalPrev.hidden = currentImages.length <= 1;\n		}\n		if (modalNext) {\n			modalNext.disabled = currentImages.length <= 1;\n			modalNext.hidden = currentImages.length <= 1;\n		}\n	};\n\n	const openModal = (button) => {\n		// Parse images from data attribute\n		try {\n			currentImages = JSON.parse(button.dataset.images ?? "[]");\n		} catch (error) {\n			console.error("Failed to parse images", error);\n			currentImages = [];\n		}\n		\n		currentImageIndex = 0;\n		\n		// Set specimen-level information\n		modalDescription.textContent = button.dataset.description ?? "";\n		modalFinder.textContent = button.dataset.finder ?? "";\n		\n		// Format the date for display\n		const dateStr = button.dataset.date ?? "";\n		if (dateStr) {\n			modalDate.textContent = formatDateString(dateStr);\n		} else {\n			modalDate.textContent = "";\n		}\n\n		try {\n			const parsedTags = JSON.parse(button.dataset.tags ?? "[]");\n			modalTags.innerHTML = formatTags(parsedTags);\n		} catch (error) {\n			console.error("Failed to parse tags", error);\n			modalTags.innerHTML = "";\n		}\n		\n		// Update image display\n		updateModalImage(0);\n\n		if (typeof modal.showModal === "function" && !modal.open) {\n			modal.showModal();\n		} else {\n			modal.setAttribute("open", "");\n		}\n	};\n	\n	const navigateImage = (direction) => {\n		if (!currentImages || currentImages.length === 0) return;\n		\n		if (direction === \'next\') {\n			currentImageIndex = (currentImageIndex + 1) % currentImages.length;\n		} else if (direction === \'prev\') {\n			currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;\n		}\n		\n		updateModalImage(currentImageIndex);\n	};\n\n	const closeModal = () => {\n		if (typeof modal.close === "function" && modal.open) {\n			modal.close();\n		} else {\n			modal.removeAttribute("open");\n		}\n	};\n\n	gallery?.addEventListener("click", (event) => {\n		const button = event.target.closest(".gallery-card__button");\n		if (!button) return;\n		openModal(button);\n	});\n	\n	modalPrev?.addEventListener("click", () => {\n		navigateImage(\'prev\');\n	});\n	\n	modalNext?.addEventListener("click", () => {\n		navigateImage(\'next\');\n	});\n	\n	// Keyboard navigation\n	document.addEventListener("keydown", (event) => {\n		if (!modal || !modal.open) return;\n		if (event.key === "ArrowLeft") {\n			navigateImage(\'prev\');\n		} else if (event.key === "ArrowRight") {\n			navigateImage(\'next\');\n		}\n	});\n\n	modal?.addEventListener("click", (event) => {\n		if (event.target.closest("[data-close-modal]")) {\n			closeModal();\n		}\n	});\n\n	document.addEventListener("keydown", (event) => {\n		if (event.key === "Escape") {\n			closeModal();\n		}\n	});\n\n	loadMoreButton?.addEventListener("click", async () => {\n		loadMoreButton.disabled = true;\n		loadMoreButton.textContent = "Loading\u2026";\n\n		const lastId = loadMoreButton.dataset.lastId || \n			Array.from(gallery.querySelectorAll(".gallery-card"))\n				.pop()\n				?.dataset.specimenId;\n\n		try {\n			const url = new URL("/api/fossil-sorting-images", window.location.origin);\n			if (lastId) {\n				url.searchParams.set("afterId", lastId);\n			}\n\n			const response = await fetch(url.toString());\n			if (!response.ok) {\n				throw new Error(`Failed to load images (${response.status})`);\n			}\n\n			const payload = await response.json();\n			const newSpecimens = Array.isArray(payload.images) ? payload.images : [];\n\n			newSpecimens.forEach((specimen, index) => {\n				setTimeout(() => {\n					const card = createCard(specimen);\n					gallery.append(card);\n					// Ensure the browser applies the initial styles before toggling visibility\n					// so the transition runs reliably across browsers.\n					// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n					card.offsetWidth;\n					requestAnimationFrame(() => {\n						card.classList.add("is-visible");\n					});\n				}, index * 100);\n			});\n\n			if (payload.nextCursor) {\n				loadMoreButton.dataset.lastId = payload.nextCursor;\n			}\n			updateLoadMoreVisibility(Boolean(payload.hasMore));\n		} catch (error) {\n			console.error(error);\n			loadMoreButton.textContent = "Something went wrong \u2013 try again";\n		} finally {\n			loadMoreButton.disabled = false;\n			if (!loadMoreButton.hidden) {\n				loadMoreButton.textContent = "Get more images";\n			}\n		}\n	});\n\n	if (loadMoreButton) {\n		updateLoadMoreVisibility(true);\n	}\n<\/script> '], ["", ' <script type="module">\n	const gallery = document.querySelector("#image-gallery");\n	const loadMoreButton = document.querySelector("#load-more-images");\n	const searchContainer = document.querySelector("#image-search");\n	const searchInput = document.querySelector("#search-input");\n	const searchButton = document.querySelector("#search-button");\n	const searchReset = document.querySelector("#search-reset");\n	const searchStatus = document.querySelector("#search-status");\n	const searchEmpty = document.querySelector("#search-empty");\n	const searchError = document.querySelector("#search-error");\n	const searchErrorDetails = document.querySelector("#search-error-details");\n	const modal = document.querySelector("#image-modal");\n	const modalPicture = document.querySelector("#image-modal-picture");\n	const modalDescription = document.querySelector("#image-modal-description");\n	const modalFinder = document.querySelector("#image-modal-finder");\n	const modalPhoto = document.querySelector("#image-modal-photo");\n	const modalDate = document.querySelector("#image-modal-date");\n	const modalTags = document.querySelector("#image-modal-tags");\n	const modalPrev = document.querySelector("#image-modal-prev");\n	const modalNext = document.querySelector("#image-modal-next");\n	const modalCounter = document.querySelector("#image-modal-counter");\n	\n	let currentImages = [];\n	let currentImageIndex = 0;\n\n	const formatDateString = (dateStr) => {\n		// Parse date string (YYYY-MM-DD) without timezone issues\n		const [year, month, day] = dateStr.split(\'-\');\n		const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n		return date.toLocaleDateString(\'en-US\', {\n			year: \'numeric\',\n			month: \'long\',\n			day: \'numeric\'\n		});\n	};\n\n	const formatTags = (tags) => {\n		if (!Array.isArray(tags) || tags.length === 0) {\n			return \\`<p>No tags</p>\\`;\n		}\n\n		return tags\n			.map(\n				(tag) => \\`<span class="tag">\\${tag}</span>\\`,\n			)\n			.join("");\n	};\n\n	const escapeHtml = (text) => {\n		const div = document.createElement("div");\n		div.textContent = text;\n		return div.innerHTML;\n	};\n\n	const createCard = (specimen) => {\n		const card = document.createElement("article");\n		card.className = "gallery-card fade-in";\n		card.dataset.specimenId = specimen.id;\n\n		const formattedDate = formatDateString(specimen.date);\n		const safeDescription = escapeHtml(specimen.description ?? "");\n\n		card.innerHTML = \\`\n			<button\n				type="button"\n				class="gallery-card__button"\n				data-specimen-id="\\${specimen.id}"\n				data-description="\\${safeDescription}"\n				data-finder="\\${escapeHtml(specimen.finderCredit ?? "")}"\n				data-photo="\\${escapeHtml(specimen.photoCredit ?? "")}"\n				data-date="\\${specimen.date}"\n				data-tags=\'\\${JSON.stringify(specimen.tags ?? [])}\'\n				data-images=\'\\${JSON.stringify(specimen.images ?? [])}\'\n			>\n				<img\n					class="gallery-card__image"\n					src="\\${specimen.thumbnailSrc}"\n					loading="lazy"\n					alt="\\${safeDescription}"\n				/>\n				<div class="gallery-card__details">\n					<p class="gallery-card__description">\\${safeDescription}</p>\n					<p class="gallery-card__date"><strong>Date:</strong> \\${formattedDate}</p>\n				</div>\n			</button>\n		\\`;\n\n		return card;\n	};\n\n	const updateLoadMoreVisibility = (hasMore) => {\n		if (!loadMoreButton) {\n			return;\n		}\n\n		loadMoreButton.hidden = !hasMore;\n		if (!hasMore) {\n			loadMoreButton.dataset.lastId = "";\n		}\n	};\n\n	const clearGallery = () => {\n		if (!gallery) return;\n		gallery.innerHTML = "";\n	};\n\n	const renderImages = (specimens) => {\n		if (!gallery || !Array.isArray(specimens)) return;\n		specimens.forEach((specimen, index) => {\n			setTimeout(() => {\n				const card = createCard(specimen);\n				gallery.append(card);\n				// Ensure the browser applies the initial styles before toggling visibility\n				// so the transition runs reliably across browsers.\n				// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n				card.offsetWidth;\n				requestAnimationFrame(() => {\n					card.classList.add("is-visible");\n				});\n			}, index * 100);\n		});\n	};\n\n	const setSearching = (isSearching) => {\n		if (!searchStatus) return;\n		searchStatus.hidden = !isSearching;\n	};\n\n	const clearSearchIndicators = () => {\n		if (searchEmpty) searchEmpty.hidden = true;\n		if (searchError) searchError.hidden = true;\n		if (searchErrorDetails) searchErrorDetails.textContent = "";\n	};\n\n	const showEmpty = () => {\n		if (searchEmpty) searchEmpty.hidden = false;\n	};\n\n	const showError = (error) => {\n		if (!searchError) return;\n		searchError.hidden = false;\n		if (searchErrorDetails) {\n			searchErrorDetails.textContent = String(error?.message ?? error ?? "Unknown error");\n		}\n	};\n\n	const performSearch = async (query) => {\n		try {\n			setSearching(true);\n			clearSearchIndicators();\n			if (loadMoreButton) {\n				loadMoreButton.hidden = true;\n			}\n			const url = new URL("/api/fossil-sorting-images", window.location.origin);\n			if (query) {\n				url.searchParams.set("q", query);\n			}\n			const response = await fetch(url.toString());\n			if (!response.ok) {\n				throw new Error(\\`Search failed (\\${response.status})\\`);\n			}\n			const payload = await response.json();\n			clearGallery();\n			const specimens = Array.isArray(payload.images) ? payload.images : [];\n			if (specimens.length === 0) {\n				showEmpty();\n			} else {\n				renderImages(specimens);\n			}\n		} catch (error) {\n			console.error(error);\n			clearGallery();\n			showError(error);\n		} finally {\n			setSearching(false);\n		}\n	};\n\n	const performReset = async () => {\n		try {\n			setSearching(true);\n			clearSearchIndicators();\n			const url = new URL("/api/fossil-sorting-images", window.location.origin);\n			const response = await fetch(url.toString());\n			if (!response.ok) {\n				throw new Error(\\`Reset failed (\\${response.status})\\`);\n			}\n			const payload = await response.json();\n			clearGallery();\n			const specimens = Array.isArray(payload.images) ? payload.images : [];\n			if (specimens.length === 0) {\n				showEmpty();\n			} else {\n				renderImages(specimens);\n			}\n			if (payload.nextCursor && loadMoreButton) {\n				loadMoreButton.dataset.lastId = payload.nextCursor;\n			}\n			updateLoadMoreVisibility(Boolean(payload.hasMore));\n		} catch (error) {\n			console.error(error);\n			clearGallery();\n			showError(error);\n		} finally {\n			setSearching(false);\n		}\n	};\n\n	searchButton?.addEventListener("click", () => {\n		const q = (searchInput?.value ?? "").trim();\n		void performSearch(q);\n	});\n\n	searchInput?.addEventListener("keydown", (event) => {\n		if (event.key === "Enter") {\n			const q = (searchInput?.value ?? "").trim();\n			void performSearch(q);\n		}\n	});\n\n	searchReset?.addEventListener("click", () => {\n		if (searchInput) {\n			searchInput.value = "";\n		}\n		void performReset();\n	});\n\n	const updateModalImage = (imageIndex) => {\n		if (!currentImages || currentImages.length === 0) return;\n		\n		const image = currentImages[imageIndex];\n		if (!image) return;\n		\n		modalPicture.src = image.src ?? "";\n		modalPicture.alt = image.description ?? "";\n		modalPhoto.textContent = image.photoCredit ?? "";\n		\n		// Update counter\n		if (modalCounter) {\n			modalCounter.textContent = \\`\\${imageIndex + 1} / \\${currentImages.length}\\`;\n		}\n		\n		// Update navigation buttons\n		if (modalPrev) {\n			modalPrev.disabled = currentImages.length <= 1;\n			modalPrev.hidden = currentImages.length <= 1;\n		}\n		if (modalNext) {\n			modalNext.disabled = currentImages.length <= 1;\n			modalNext.hidden = currentImages.length <= 1;\n		}\n	};\n\n	const openModal = (button) => {\n		// Parse images from data attribute\n		try {\n			currentImages = JSON.parse(button.dataset.images ?? "[]");\n		} catch (error) {\n			console.error("Failed to parse images", error);\n			currentImages = [];\n		}\n		\n		currentImageIndex = 0;\n		\n		// Set specimen-level information\n		modalDescription.textContent = button.dataset.description ?? "";\n		modalFinder.textContent = button.dataset.finder ?? "";\n		\n		// Format the date for display\n		const dateStr = button.dataset.date ?? "";\n		if (dateStr) {\n			modalDate.textContent = formatDateString(dateStr);\n		} else {\n			modalDate.textContent = "";\n		}\n\n		try {\n			const parsedTags = JSON.parse(button.dataset.tags ?? "[]");\n			modalTags.innerHTML = formatTags(parsedTags);\n		} catch (error) {\n			console.error("Failed to parse tags", error);\n			modalTags.innerHTML = "";\n		}\n		\n		// Update image display\n		updateModalImage(0);\n\n		if (typeof modal.showModal === "function" && !modal.open) {\n			modal.showModal();\n		} else {\n			modal.setAttribute("open", "");\n		}\n	};\n	\n	const navigateImage = (direction) => {\n		if (!currentImages || currentImages.length === 0) return;\n		\n		if (direction === \'next\') {\n			currentImageIndex = (currentImageIndex + 1) % currentImages.length;\n		} else if (direction === \'prev\') {\n			currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;\n		}\n		\n		updateModalImage(currentImageIndex);\n	};\n\n	const closeModal = () => {\n		if (typeof modal.close === "function" && modal.open) {\n			modal.close();\n		} else {\n			modal.removeAttribute("open");\n		}\n	};\n\n	gallery?.addEventListener("click", (event) => {\n		const button = event.target.closest(".gallery-card__button");\n		if (!button) return;\n		openModal(button);\n	});\n	\n	modalPrev?.addEventListener("click", () => {\n		navigateImage(\'prev\');\n	});\n	\n	modalNext?.addEventListener("click", () => {\n		navigateImage(\'next\');\n	});\n	\n	// Keyboard navigation\n	document.addEventListener("keydown", (event) => {\n		if (!modal || !modal.open) return;\n		if (event.key === "ArrowLeft") {\n			navigateImage(\'prev\');\n		} else if (event.key === "ArrowRight") {\n			navigateImage(\'next\');\n		}\n	});\n\n	modal?.addEventListener("click", (event) => {\n		if (event.target.closest("[data-close-modal]")) {\n			closeModal();\n		}\n	});\n\n	document.addEventListener("keydown", (event) => {\n		if (event.key === "Escape") {\n			closeModal();\n		}\n	});\n\n	loadMoreButton?.addEventListener("click", async () => {\n		loadMoreButton.disabled = true;\n		loadMoreButton.textContent = "Loading\u2026";\n\n		const lastId = loadMoreButton.dataset.lastId || \n			Array.from(gallery.querySelectorAll(".gallery-card"))\n				.pop()\n				?.dataset.specimenId;\n\n		try {\n			const url = new URL("/api/fossil-sorting-images", window.location.origin);\n			if (lastId) {\n				url.searchParams.set("afterId", lastId);\n			}\n\n			const response = await fetch(url.toString());\n			if (!response.ok) {\n				throw new Error(\\`Failed to load images (\\${response.status})\\`);\n			}\n\n			const payload = await response.json();\n			const newSpecimens = Array.isArray(payload.images) ? payload.images : [];\n\n			newSpecimens.forEach((specimen, index) => {\n				setTimeout(() => {\n					const card = createCard(specimen);\n					gallery.append(card);\n					// Ensure the browser applies the initial styles before toggling visibility\n					// so the transition runs reliably across browsers.\n					// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n					card.offsetWidth;\n					requestAnimationFrame(() => {\n						card.classList.add("is-visible");\n					});\n				}, index * 100);\n			});\n\n			if (payload.nextCursor) {\n				loadMoreButton.dataset.lastId = payload.nextCursor;\n			}\n			updateLoadMoreVisibility(Boolean(payload.hasMore));\n		} catch (error) {\n			console.error(error);\n			loadMoreButton.textContent = "Something went wrong \u2013 try again";\n		} finally {\n			loadMoreButton.disabled = false;\n			if (!loadMoreButton.hidden) {\n				loadMoreButton.textContent = "Get more images";\n			}\n		}\n	});\n\n	if (loadMoreButton) {\n		updateLoadMoreVisibility(true);\n	}\n<\/script> '])), renderComponent($$result, "Layout", $$Layout, { "subtitle": "Fossil Sorting Images" }, { "default": ($$result2) => renderTemplate` ${renderComponent($$result2, "HeadingWithBackground", $$HeadingWithBackground, { "background": "/events/2025/fishSkull.jpeg", "backgroundPositionY": "50%" }, { "default": ($$result3) => renderTemplate` ${maybeRenderHead()}<h1>Fossil Sorting Image Gallery</h1> ` })} <section class="intro"> <p>
Our fossil sorting program invites volunteers to help process microfossil matrix for the research teams of
<a href="https://profiles.ucalgary.ca/jessica-theodor" target="_blank" rel="noreferrer">Dr. Jessica Theodor</a>
and
<a href="https://profiles.ucalgary.ca/alex-dutchak" target="_blank" rel="noreferrer">Dr. Alex Dutchak</a>
at the University of Calgary. Participants comb through sediment, catalogue their discoveries, and support ongoing palaeontological research.
</p> <p>
Browse highlights from recent sessions below. Each thumbnail opens a closer look with additional details, including the date and tags for the discovery.
</p> </section> <details class="search" id="image-search"> <summary>Search images</summary> <div class="search__controls"> <label for="search-input" class="visually-hidden">Search terms</label> <input id="search-input" type="text" placeholder="Search description, finder, photo, tags…"> <button id="search-button" class="search__button" type="button">Search</button> <button id="search-reset" class="search__button search__button--secondary" type="button">Reset</button> </div> <p id="search-status" class="search__status" hidden>Searching...</p> <p id="search-empty" class="search__empty" hidden>No images found.</p> <div id="search-error" class="search__error" hidden> <p class="search__error-title">An error occurred while searching.</p> <details> <summary>Details</summary> <pre id="search-error-details"></pre> </details> </div> </details> <section class="gallery" id="image-gallery"> ${initialSpecimens.map((specimen) => renderTemplate`<article class="gallery-card"${addAttribute(specimen.id, "data-specimen-id")}> <button type="button" class="gallery-card__button"${addAttribute(specimen.id, "data-specimen-id")}${addAttribute(specimen.description, "data-description")}${addAttribute(specimen.finderCredit, "data-finder")}${addAttribute(specimen.photoCredit, "data-photo")}${addAttribute(specimen.date, "data-date")}${addAttribute(JSON.stringify(specimen.tags), "data-tags")}${addAttribute(JSON.stringify(specimen.images), "data-images")}> <img class="gallery-card__image"${addAttribute(specimen.thumbnailSrc, "src")} loading="lazy"${addAttribute(specimen.description, "alt")}> <div class="gallery-card__details"> <p class="gallery-card__description">${specimen.description}</p> <p class="gallery-card__date"><strong>Date:</strong> ${formatDateString(specimen.date)}</p> </div> </button> </article>`)} </section> ${remainingSpecimens > 0 && renderTemplate`<div class="load-more"> <button id="load-more-images" class="load-more__button"${addAttribute(initialLastId ?? "", "data-last-id")}>
Get more images
</button> </div>`}<dialog id="image-modal" class="image-modal"> <div class="image-modal__backdrop" data-close-modal></div> <div class="image-modal__content"> <button class="image-modal__close" type="button" data-close-modal aria-label="Close image dialog">×</button> <div class="image-modal__slideshow"> <button class="image-modal__prev" type="button" aria-label="Previous image" id="image-modal-prev">‹</button> <div class="image-modal__image-container"> <img id="image-modal-picture" alt=""> <div class="image-modal__image-counter" id="image-modal-counter"></div> </div> <button class="image-modal__next" type="button" aria-label="Next image" id="image-modal-next">›</button> </div> <div class="image-modal__text"> <p id="image-modal-description" class="image-modal__description"></p> <div class="image-modal__credits"> <p class="image-modal__credit"><strong>Finder:</strong> <span id="image-modal-finder"></span></p> <p class="image-modal__credit"><strong>Photo:</strong> <span id="image-modal-photo"></span></p> <p class="image-modal__date"><strong>Date:</strong> <span id="image-modal-date"></span></p> </div> <div class="image-modal__tags" id="image-modal-tags" aria-label="Image tags"></div> </div> </div> </dialog> ` }));
}, "/Users/ericr/documents/alberta-paleontological-society-website/src/pages/events/fossilsorting/images.astro", void 0);

const $$file = "/Users/ericr/documents/alberta-paleontological-society-website/src/pages/events/fossilsorting/images.astro";
const $$url = "/events/fossilsorting/images";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
	__proto__: null,
	default: $$Images,
	file: $$file,
	url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
